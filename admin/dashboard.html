<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Lighthouse Admin</title>
  <link rel="stylesheet" href="/dist/css/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">
  <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
  <style>
    [x-cloak] { display: none !important; }

    /* Typography */
    .font-display { font-family: 'Fraunces', Georgia, serif; }
    .font-body { font-family: 'DM Sans', system-ui, sans-serif; }

    body {
      font-family: 'DM Sans', system-ui, sans-serif;
      background: #FAFAF9;
    }

    /* Sidebar */
    .sidebar { width: 280px; }
    .main-content { margin-left: 280px; }

    @media (max-width: 1024px) {
      .sidebar { transform: translateX(-100%); position: fixed; z-index: 50; }
      .sidebar.open { transform: translateX(0); }
      .main-content { margin-left: 0; }
    }

    /* Stat Card */
    .stat-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.4s ease-out forwards;
    }

    /* Stagger children */
    .stagger-children > *:nth-child(1) { animation-delay: 0ms; }
    .stagger-children > *:nth-child(2) { animation-delay: 50ms; }
    .stagger-children > *:nth-child(3) { animation-delay: 100ms; }
    .stagger-children > *:nth-child(4) { animation-delay: 150ms; }
    .stagger-children > *:nth-child(5) { animation-delay: 200ms; }
    .stagger-children > *:nth-child(n+6) { animation-delay: 250ms; }
  </style>
</head>
<body class="font-body min-h-screen" x-data="adminDashboard()">

  <!-- Sidebar -->
  <aside class="sidebar fixed top-0 left-0 h-full text-white transition-transform duration-300"
         style="background-color: #0f172a;"
         :class="{ 'open': sidebarOpen }">
    <div class="p-6" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
      <img src="/src/assets/images/logo/LightHouse-Logo-White.png" alt="Lighthouse" class="h-10">
    </div>

    <nav class="py-4">
      <a href="/admin/dashboard.html"
         class="flex items-center px-6 py-3 text-white"
         style="background-color: rgba(255,255,255,0.1); border-right: 2px solid #D6B86A;">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
        </svg>
        <span class="font-medium">Dashboard</span>
      </a>
      <a href="/admin/gallery-manage.html"
         class="flex items-center px-6 py-3 transition-all"
         style="color: rgba(255,255,255,0.6);"
         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='white';"
         onmouseout="this.style.backgroundColor='transparent'; this.style.color='rgba(255,255,255,0.6)';">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <span class="font-medium">Gallery</span>
      </a>
      <a href="/admin/blog-manage.html"
         class="flex items-center px-6 py-3 transition-all"
         style="color: rgba(255,255,255,0.6);"
         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='white';"
         onmouseout="this.style.backgroundColor='transparent'; this.style.color='rgba(255,255,255,0.6)';">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
        </svg>
        <span class="font-medium">Blog</span>
      </a>
      <a href="/admin/comments-manage.html"
         class="flex items-center px-6 py-3 transition-all"
         style="color: rgba(255,255,255,0.6);"
         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='white';"
         onmouseout="this.style.backgroundColor='transparent'; this.style.color='rgba(255,255,255,0.6)';">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
        </svg>
        <span class="font-medium">Comments</span>
      </a>
      <a href="/admin/users-manage.html" x-show="user?.role === 'admin'"
         class="flex items-center px-6 py-3 transition-all"
         style="color: rgba(255,255,255,0.6);"
         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='white';"
         onmouseout="this.style.backgroundColor='transparent'; this.style.color='rgba(255,255,255,0.6)';">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        <span class="font-medium">Users</span>
      </a>
    </nav>

    <div class="absolute bottom-0 left-0 right-0 p-6" style="border-top: 1px solid rgba(255,255,255,0.1);">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-white" x-text="user?.username"></p>
          <p class="text-xs capitalize" style="color: rgba(255,255,255,0.4);" x-text="user?.role"></p>
        </div>
        <button @click="logout" class="p-2 rounded-lg transition-all" style="color: rgba(255,255,255,0.4);"
                onmouseover="this.style.color='white'; this.style.backgroundColor='rgba(255,255,255,0.1)';"
                onmouseout="this.style.color='rgba(255,255,255,0.4)'; this.style.backgroundColor='transparent';">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
          </svg>
        </button>
      </div>
    </div>
  </aside>

  <!-- Mobile Header -->
  <header class="lg:hidden fixed top-0 left-0 right-0 text-white p-4 z-40 flex items-center justify-between"
          style="background-color: #0f172a;">
    <button @click="sidebarOpen = !sidebarOpen" class="p-2 rounded-lg transition-all"
            onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)';"
            onmouseout="this.style.backgroundColor='transparent';">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
    <span class="font-display font-semibold">Dashboard</span>
    <button @click="logout" class="p-2 rounded-lg transition-all"
            onmouseover="this.style.backgroundColor='rgba(255,255,255,0.1)';"
            onmouseout="this.style.backgroundColor='transparent';">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
      </svg>
    </button>
  </header>

  <!-- Overlay -->
  <div x-show="sidebarOpen" @click="sidebarOpen = false" x-cloak
       class="lg:hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-40"></div>

  <!-- Main Content -->
  <main class="main-content min-h-screen pt-16 lg:pt-0">
    <div class="p-6 lg:p-8 max-w-[1600px]">
      <!-- Header -->
      <div class="mb-8">
        <h1 class="font-display text-2xl lg:text-3xl font-bold tracking-tight" style="color: #0f172a;">Dashboard</h1>
        <p class="text-slate-500 mt-1">Welcome back, <span x-text="user?.username"></span></p>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8 stagger-children">
        <!-- Total Items -->
        <div class="stat-card animate-fade-in-up">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-slate-400 uppercase tracking-wide">Total Gallery Items</p>
              <p class="text-2xl font-bold mt-1" style="color: #0f172a;" x-text="stats.total">0</p>
            </div>
            <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background-color: rgba(214, 184, 106, 0.1);">
              <svg class="w-6 h-6" style="color: #D6B86A;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Images -->
        <div class="stat-card animate-fade-in-up">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-slate-400 uppercase tracking-wide">Images</p>
              <p class="text-2xl font-bold text-blue-600 mt-1" x-text="stats.images">0</p>
            </div>
            <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Videos -->
        <div class="stat-card animate-fade-in-up">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-slate-400 uppercase tracking-wide">Videos</p>
              <p class="text-2xl font-bold text-purple-600 mt-1" x-text="stats.videos">0</p>
            </div>
            <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Embeds -->
        <div class="stat-card animate-fade-in-up">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-slate-400 uppercase tracking-wide">Video Embeds</p>
              <p class="text-2xl font-bold text-red-600 mt-1" x-text="stats.embeds">0</p>
            </div>
            <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Published Blog Posts -->
        <div class="stat-card animate-fade-in-up">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-slate-400 uppercase tracking-wide">Published Posts</p>
              <p class="text-2xl font-bold text-emerald-600 mt-1" x-text="blogStats.published">0</p>
            </div>
            <div class="w-12 h-12 bg-emerald-50 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Draft Blog Posts -->
        <div class="stat-card animate-fade-in-up">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-slate-400 uppercase tracking-wide">Draft Posts</p>
              <p class="text-2xl font-bold text-slate-600 mt-1" x-text="blogStats.draft">0</p>
            </div>
            <div class="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
        <h2 class="font-display text-lg font-semibold mb-4" style="color: #0f172a;">Quick Actions</h2>
        <div class="flex flex-wrap gap-4">
          <a href="/admin/gallery-manage.html"
             class="inline-flex items-center px-5 py-2.5 text-white rounded-xl font-medium transition-all shadow-sm hover:shadow-md"
             style="background-color: #D6B86A;"
             onmouseover="this.style.backgroundColor='#c9a85a';"
             onmouseout="this.style.backgroundColor='#D6B86A';">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Gallery Items
          </a>
          <a href="/pages/gallery.html" target="_blank"
             class="inline-flex items-center px-5 py-2.5 bg-white border border-slate-200 rounded-xl font-medium hover:bg-slate-50 hover:border-slate-300 transition-all"
             style="color: #0f172a;">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
            </svg>
            View Public Gallery
          </a>
        </div>
      </div>

      <!-- System Info -->
      <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
        <h2 class="font-display text-lg font-semibold mb-4" style="color: #0f172a;">System Info</h2>
        <div class="space-y-3 text-sm text-slate-600">
          <div class="flex justify-between py-2 border-b border-slate-100">
            <span>Logged in as</span>
            <span class="font-medium" style="color: #0f172a;" x-text="user?.username"></span>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-100">
            <span>Role</span>
            <span class="font-medium capitalize" style="color: #0f172a;" x-text="user?.role"></span>
          </div>
          <div class="flex justify-between py-2">
            <span>Gallery endpoint</span>
            <a href="/api/gallery" target="_blank" class="font-medium transition-all hover:underline" style="color: #D6B86A;">/api/gallery</a>
          </div>
        </div>
      </div>

      <!-- Database Backup & Restore (Admin only) -->
      <div class="bg-white rounded-xl shadow-sm p-6" x-show="user?.role === 'admin'">
        <h2 class="font-display text-lg font-semibold mb-4" style="color: #0f172a;">Database Backup</h2>

        <!-- Backup Status -->
        <div class="mb-6 p-4 bg-slate-50 rounded-xl" x-show="backupStatus">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-slate-600">Last backup:</span>
            <span class="text-sm font-medium" style="color: #0f172a;" x-text="backupStatus?.lastBackup ? new Date(backupStatus.lastBackup).toLocaleString() : 'Never'"></span>
          </div>
          <div class="flex items-center justify-between" x-show="backupStatus?.lastBackupSize">
            <span class="text-sm text-slate-600">Backup size:</span>
            <span class="text-sm font-medium" style="color: #0f172a;" x-text="formatBytes(backupStatus?.lastBackupSize)"></span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-4">
          <button @click="triggerBackup()" :disabled="backupLoading"
                  class="inline-flex items-center px-5 py-2.5 text-white rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                  style="background-color: #5C88A0;"
                  onmouseover="if(!this.disabled) this.style.backgroundColor='#4a7590';"
                  onmouseout="this.style.backgroundColor='#5C88A0';">
            <svg x-show="!backupLoading" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            <svg x-show="backupLoading" class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
            <span x-text="backupLoading ? 'Backing up...' : 'Create Backup'"></span>
          </button>

          <button @click="showRestoreConfirm = true" :disabled="!backupStatus?.backupExists"
                  class="inline-flex items-center px-5 py-2.5 bg-orange-500 text-white rounded-xl font-medium hover:bg-orange-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Restore from Backup
          </button>
        </div>

        <!-- Success/Error Messages -->
        <div x-show="backupMessage" class="mt-4 p-4 rounded-xl" :class="backupError ? 'bg-red-50 text-red-700' : 'bg-emerald-50 text-emerald-700'">
          <p class="font-medium" x-text="backupMessage"></p>
        </div>
      </div>

      <!-- Restore Confirmation Modal -->
      <div x-show="showRestoreConfirm" x-cloak class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50" @click.self="showRestoreConfirm = false">
        <div class="bg-white rounded-2xl p-6 max-w-md mx-4 shadow-2xl">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center">
              <svg class="w-7 h-7 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
            </div>
            <h3 class="font-display text-lg font-bold" style="color: #0f172a;">Restore Database?</h3>
          </div>
          <p class="text-slate-600 mb-6">This will replace the current database with the backup. All changes since the last backup will be lost. You will be logged out after the restore.</p>
          <div class="flex justify-end gap-3">
            <button @click="showRestoreConfirm = false" class="px-5 py-2.5 text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-xl transition-all font-medium">Cancel</button>
            <button @click="triggerRestore()" :disabled="restoreLoading"
                    class="inline-flex items-center px-5 py-2.5 bg-orange-500 text-white rounded-xl font-medium hover:bg-orange-600 transition-all disabled:opacity-50">
              <svg x-show="restoreLoading" class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
              </svg>
              <span x-text="restoreLoading ? 'Restoring...' : 'Restore Now'"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    function adminDashboard() {
      return {
        user: null,
        stats: { total: 0, images: 0, videos: 0, embeds: 0 },
        blogStats: { total: 0, published: 0, draft: 0 },
        sidebarOpen: false,

        // Backup state
        backupStatus: null,
        backupLoading: false,
        restoreLoading: false,
        showRestoreConfirm: false,
        backupMessage: '',
        backupError: false,

        async init() {
          await this.checkAuth();
          await this.loadStats();
          await this.loadBlogStats();
          if (this.user?.role === 'admin') {
            await this.loadBackupStatus();
          }
        },

        async checkAuth() {
          try {
            const res = await fetch('/api/auth/check');
            const data = await res.json();

            if (!data.authenticated) {
              window.location.href = '/admin/';
              return;
            }

            this.user = data.user;
          } catch (err) {
            console.error('Auth check failed:', err);
            window.location.href = '/admin/';
          }
        },

        async loadStats() {
          try {
            const res = await fetch('/api/gallery/stats/summary');
            if (res.ok) {
              this.stats = await res.json();
            }
          } catch (err) {
            console.error('Failed to load stats:', err);
          }
        },

        async loadBlogStats() {
          try {
            const res = await fetch('/api/admin/blog');
            if (res.ok) {
              const data = await res.json();
              if (data.counts) {
                this.blogStats = data.counts;
              }
            }
          } catch (err) {
            console.error('Failed to load blog stats:', err);
          }
        },

        async loadBackupStatus() {
          try {
            const res = await fetch('/api/admin/backup/status');
            if (res.ok) {
              const data = await res.json();
              this.backupStatus = data.status;
            }
          } catch (err) {
            console.error('Failed to load backup status:', err);
          }
        },

        async triggerBackup() {
          this.backupLoading = true;
          this.backupMessage = '';
          this.backupError = false;

          try {
            const res = await fetch('/api/admin/backup', { method: 'POST' });
            const data = await res.json();

            if (res.ok) {
              this.backupMessage = 'Backup created successfully!';
              await this.loadBackupStatus();
            } else {
              this.backupError = true;
              this.backupMessage = data.message || 'Backup failed';
            }
          } catch (err) {
            console.error('Backup failed:', err);
            this.backupError = true;
            this.backupMessage = 'Backup failed. Please try again.';
          } finally {
            this.backupLoading = false;
          }
        },

        async triggerRestore() {
          this.restoreLoading = true;

          try {
            const res = await fetch('/api/admin/backup/restore', { method: 'POST' });
            const data = await res.json();

            if (res.ok) {
              alert('Database restored successfully! You will be logged out.');
              window.location.href = '/admin/';
            } else {
              this.showRestoreConfirm = false;
              this.backupError = true;
              this.backupMessage = data.message || 'Restore failed';
            }
          } catch (err) {
            console.error('Restore failed:', err);
            this.showRestoreConfirm = false;
            this.backupError = true;
            this.backupMessage = 'Restore failed. Please try again.';
          } finally {
            this.restoreLoading = false;
          }
        },

        formatBytes(bytes) {
          if (!bytes) return '0 B';
          const k = 1024;
          const sizes = ['B', 'KB', 'MB', 'GB'];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        },

        async logout() {
          try {
            await fetch('/api/auth/logout', { method: 'POST' });
            window.location.href = '/admin/';
          } catch (err) {
            console.error('Logout failed:', err);
          }
        }
      };
    }
  </script>
</body>
</html>
